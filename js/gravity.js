window.MOBILE = true;
(function(){var t,e={}.hasOwnProperty,i=function(t,i){function s(){this.constructor=t}for(var o in i)e.call(i,o)&&(t[o]=i[o]);return s.prototype=i.prototype,t.prototype=new s,t.__super__=i.prototype,t};window.Components=new Object,Components.Physics=function(t){function e(t){this.state=t,e.__super__.constructor.call(this,this.state),this.velocity=new Vector}return i(e,t),e.label("physics"),e.property("position",new Vector),e.property("rotation",0),e.property("velocity"),e.property("angularVelocity",0),e.property("radius",3),e.property("mass",1),e.property("gravityField",6),e.prototype.update=function(){return this.state.components.filter(function(t){return null!=t&&"Physics"===t.constructor.name}).forEach(function(t){return function(e){var i,s,o,r,n;if(e.id!==t.id&&null!==e)return r=Math.max(t.radius,e.radius),i=e.position.distance(t.position),s=i-t.radius<r*t.gravityField?t.mass*e.mass/(i*i):0,i-t.radius<r&&(s=0,o=e.position.sub(t.position).normalize().mul(-1),n=Math.acos(t.velocity.dot(o)/t.velocity.length()),t.velocity.rotate(n),"Player"!==t.parent.constructor.name&&"Player"!==e.parent.constructor.name||t.state.collided()),t.velocity._add(t.position.sub(e.position).normalize().mul(-s))}}(this)),this.position._add(this.velocity),this.rotation+=this.angularVelocity},e}(Axe.Component),Components.Planet=function(t){function e(t){this.state=t,e.__super__.constructor.call(this,this.state)}return i(e,t),e.label("planet"),e.property("passed",!1),e.component(Components.Physics),e.component(Axe.Renderable,function(){return this.property("style"),this.property("gravityField",!0),this.render=bind(this.parent,function(){return this.render.context.save(),this.render.context.translate(this.physics.position.x,this.physics.position.y),this.render.context.rotate(this.physics.rotation),this.render.context.fillStyle=this.render.style,this.render.context.fillRect(-this.physics.radius,-this.physics.radius,2*this.physics.radius,2*this.physics.radius),this.render.gravityField&&(this.render.context.beginPath(),this.render.context.setLineDash([2,3]),this.render.context.rotate(.75*-this.physics.rotation),this.render.context.arc(0,0,this.physics.radius*this.physics.gravityField,0,2*Math.PI,!1),this.render.context.lineWidth=.5,this.render.context.strokeStyle="white",this.render.context.stroke()),this.render.context.restore()})}),e.prototype.update=function(){return(this.physics.position.y>game.canvas.height/game.pixelSize+this.physics.radius*this.physics.gravityField||this.physics.position.y<-this.physics.radius*this.physics.gravityField||this.physics.position.x>game.canvas.width/game.pixelSize+this.physics.radius*this.physics.gravityField||this.physics.position.x<-this.physics.radius*this.physics.gravityField)&&this.destroy(),this.physics.velocity.y=this.physics.y_velocity},e}(Axe.Component),Components.Player=function(t){function e(t){this.state=t,e.__super__.constructor.call(this,this.state),this.render.gravityField=!1}if(i(e,t),e.label("player"),e.include(Components.Planet),e.property("acceleration",.033),e.property("torque",.05),e.property("closest",75),window.MOBILE){if(!window.DeviceOrientationEvent)throw alert("Device orientation not supported."),new Error("Device orientation not supported.");e.component(Axe.Orientation,function(){return this.onMotion=bind(this.parent,function(t){return t.beta>1?this.physics.velocity.y-=this.acceleration:t.beta<-1&&(this.physics.velocity.y+=this.acceleration),t.alpha>1?(this.physics.velocity.x+=this.acceleration,this.physics.rotation+=(Math.PI/8-this.physics.rotation)*this.torque):t.alpha<-1?(this.physics.velocity.x-=this.acceleration,this.physics.rotation+=(Math.PI/-8-this.physics.rotation)*this.torque):this.physics.rotation+=(0-this.physics.rotation)*this.torque})})}else e.component(Axe.Keyboard,function(){return this.update=bind(this.parent,function(){return this.keyboard.keyDown(38)?this.physics.velocity.y-=this.acceleration:this.keyboard.keyDown(40)&&(this.physics.velocity.y+=this.acceleration),this.keyboard.keyDown(39)?(this.physics.velocity.x+=this.acceleration,this.physics.rotation+=(Math.PI/8-this.physics.rotation)*this.torque):this.keyboard.keyDown(37)?(this.physics.velocity.x-=this.acceleration,this.physics.rotation+=(Math.PI/-8-this.physics.rotation)*this.torque):this.physics.rotation+=(0-this.physics.rotation)*this.torque})});return e.prototype.update=function(){var t,e;return this.closest=75,this.state.components.filter(function(t){return null!=t&&t.id!==this.id&&"Planet"===t.constructor.name}).forEach(function(t){return function(e){if(t.closest=Math.min(t.closest,t.physics.position.distance(e.physics.position,75)),!e.passed&&e.physics.position.y>t.physics.position.y)return e.passed=!0,t.state.scored()}}(this)),t=game.pixelSize,e=this.physics.radius,as(this.physics,function(){if(this.position.x<e&&(this.position.x=e,this.velocity.x=0),this.position.y<e&&(this.position.y=e,this.velocity.y=0),this.position.x>game.canvas.width/t-e&&(this.position.x=game.canvas.width/t-e,this.velocity.x=0),this.position.y>game.canvas.height/t+e)return this.state.collided()}),this.render.color.r=Math.lerp(1.5,0,this.closest/75),this.render.color.g=Math.lerp(0,1,this.closest/75),this.render.color.b=Math.lerp(0,1,this.closest/75),this.render.style="rgb("+Math.round(255*this.render.color.r)+", "+Math.round(255*this.render.color.g)+", "+Math.round(255*this.render.color.b)+")",this.physics.velocity._mul(new Vector(.98)),this.physics.angularVelocity*=.95},e}(Axe.Component),Components.ScoreTexts=function(t){function e(t){this.state=t,e.__super__.constructor.call(this,this.state),this.scoredText=document.getElementById("scored-text"),this.scoredText.style.display="block",this.resize(1)}return i(e,t),e.label("scoreTexts"),e.property("scoredText",0),e.property("opacity",0),e.property("rotation",0),e.property("rotationTarget",0),e.property("size",0),e.property("sizeTarget",0),e.property("text",""),e.prototype.texts={1:"Newbie",5:"Rookie",10:"Well...",15:"You're getting it",20:"Go on!",25:"Keep calm and play",30:"Good!",40:"Nice!",50:"Awesome!",75:"Superb!",100:{text:"Godlike!",color:"red"},125:{text:"Beyond Godlike!",color:"orange"},150:"Bloody Hell!",200:"OMG!!!",250:"Holy Chips!",300:"You're an Asian!",400:"Universe Limits...",500:{text:"GG!",color:"red"}},e.prototype.scored=function(){var t;return this.opacity=1,this.rotation=random(-Math.PI/12,Math.PI/12),this.rotationTarget=random(-Math.PI/9,Math.PI/9),this.size=random(this.sizeTarget/2,2*this.sizeTarget/3),t=this.texts[this.state.score],this.text="object"==typeof t?t.text:t||"",this.scoredText.style.color="object"==typeof t?t.color:"white"},e.prototype.update=function(){var t;return this.opacity>0&&(this.opacity-=.01*(1-this.opacity)+.01),this.rotation+=.05*(this.rotationTarget-this.rotation),this.size+=.25*(this.sizeTarget-this.size),t="rotate("+this.rotation+"rad)",this.scoredText.style.top=""+2*game.canvas.height/9+"px",this.scoredText.style.MozTransform=t,this.scoredText.style.WebkitTransform=t,this.scoredText.style.OTransform=t,this.scoredText.style.transform=t,this.scoredText.style.fontSize=""+this.size+"px",this.scoredText.style.opacity=this.opacity,this.scoredText.innerHTML=this.text},e.prototype.resize=function(t){return this.sizeTarget=8*game.pixelSize,this.size=9*game.pixelSize},e.prototype.destructor=function(){return this.scoredText.style.display="none"},e}(Axe.Component),window.States=new Object,States.Menu=function(t){function e(){this.title=document.getElementById("title"),this.description=document.getElementById("description"),this.pressSpace=document.getElementById("press-space")}return i(e,t),e.property("title"),e.property("description"),e.property("pressSpace"),e.property("scroll"),e.prototype.enter=function(){return this.title.style.display="block",this.description.style.display="block",this.pressSpace.style.display="block",as(new Axe.Keyboard(this),function(){return this.onKeyUp=function(t){if(32===t)return game.states.unshift(new States.Game(this.state.scroll)),game.next()}})},e.prototype.exit=function(){return this.title.style.display="none",this.description.style.display="none",this.pressSpace.style.display="none",this.dispatch("destroy")},e.prototype.update=function(){return this.scroll=(this.scroll+1)%400,game.buffer.style.backgroundPosition="0px "+this.scroll+"px",this.pressSpace.innerHTML="Press space to play"},e.prototype.resize=function(){return this.title.style.top=""+game.canvas.height/3+"px",this.title.style.fontSize=""+game.pixelSize+"em",document.getElementById("arrow-keys").style.width=""+game.canvas.height/6+"px",this.description.style.top=""+game.canvas.height/5*3+"px",this.description.style.left=""+(window.innerWidth/2-game.canvas.width/2)+"px",this.description.style.width=""+(game.canvas.width-8)+"px",this.description.style.fontSize=""+game.pixelSize/5+"em",this.pressSpace.style.top=""+game.canvas.height/2+"px",this.pressSpace.style.fontSize=""+game.pixelSize/5+"em"},e}(Axe.State),t=Axe.Colors.filter(function(t){return"black"!==t&&"cyan"!==t&&"aqua"!==t}),States.Game=function(e){function s(t){this.scroll=t,this.scoreboard=document.getElementById("scoreboard")}return i(s,e),s.property("score"),s.property("scroll"),s.property("scoreboard"),s.property("interval"),s.prototype.enter=function(){var e;return this.score=0,this.scoreboard.style.display="block",as(new Components.Player(this),function(){return this.render.color={r:0,g:1,b:1},this.render.style="rgb(0, 255, 255)",this.physics.position=new Vector(.5/game.pixelSize,.75/game.pixelSize,(!0)),this.physics.rotation=0,this.physics.radius=6,this.physics.mass=7}),new Components.ScoreTexts(this),e=function(e){return function(){return as(new Components.Planet(e),function(){return this.render.style=t.pick(),this.physics.radius=random(8,15),this.physics.mass=random(3.5,6),this.physics.rotation=random(-Math.PI,Math.PI),this.physics.angularVelocity=random(-Math.PI/100,Math.PI/100),this.physics.velocity=new Vector(random(-.05,.05),random(1.25,1.5)),this.physics.y_velocity=this.physics.velocity.y,this.physics.position=new Vector(random(.1,.9)/game.pixelSize,0,(!0)),this.physics.position.y=-this.physics.radius*this.physics.gravityField})}}(this),this.interval=interval(2e3,e)},s.prototype.collided=function(){return game.states.unshift(new States.Score(this.score,this.scroll)),game.next()},s.prototype.scored=function(){return this.score++,this.dispatch("scored")},s.prototype.exit=function(){return this.dispatch("destroy"),this.scoreboard.style.display="none",clearInterval(this.interval)},s.prototype.update=function(){return this.dispatch("update"),this.scoreboard.innerHTML=this.score,this.scroll=(this.scroll+2)%400,game.buffer.style.backgroundPosition="0px "+this.scroll+"px"},s.prototype.resize=function(t){return this.dispatch("resize"),this.scoreboard.style.fontSize=""+3*game.pixelSize/5+"em",this.scoreboard.style.top="40px"},s}(Axe.State),States.Score=function(t){function e(t,e){this.score=t,this.scroll=e,this.scoreboard=document.getElementById("scoreboard"),this.pressSpace=document.getElementById("press-space"),this.highScore=document.getElementById("highscore")}return i(e,t),e.property("scroll"),e.property("scoreboard"),e.property("pressSpace"),e.property("highscore"),e.property("newHighScore",!1),e.prototype.enter=function(){return this.scoreboard.style.display="block",this.pressSpace.style.display="block",this.highScore.style.display="block",this.highScore.value=window.localStorage.getItem("gravity:highscore")||0,this.score>this.highScore.value&&(this.highScore.value=this.score,this.newHighScore=!0),window.localStorage.setItem("gravity:highscore",this.highScore.value),as(new Axe.Keyboard(this),function(){return this.onKeyUp=function(t){if(32===t)return game.states.unshift(new States.Menu(this.state.scroll)),game.next()}})},e.prototype.exit=function(){return this.scoreboard.style.display="none",this.pressSpace.style.display="none",this.highScore.style.display="none",this.dispatch("destroy")},e.prototype.update=function(){return this.scroll=(this.scroll+1)%400,game.buffer.style.backgroundPosition="0px "+this.scroll+"px",this.scoreboard.innerHTML="Your score was<br /><br />"+this.score,this.pressSpace.innerHTML="Press space to try again",this.highScore.innerHTML=""+(this.newHighScore?"NEW":"")+" High Score: "+this.highScore.value},e.prototype.resize=function(){return this.scoreboard.style.top=""+game.canvas.height/3+"px",this.scoreboard.style.fontSize=""+game.pixelSize/2+"em",this.pressSpace.style.top=""+game.canvas.height/3*2+"px",this.pressSpace.style.fontSize=""+game.pixelSize/5+"em",this.highScore.style.top=""+game.canvas.height/5*4+"px",this.highScore.style.fontSize=""+game.pixelSize/4+"em"},e}(Axe.State),window.onload=function(){return window.game=new Axe.Game({name:"gravity"}),game.setup(function(){return this.pixelSize=5,this.resize=function(t){var e;return this.canvas.width=this.canvas.height=Math.min(window.innerWidth,window.innerHeight),window.SIZE=new Vector(this.canvas.width,this.canvas.height),this.canvas.style.position="absolute",this.canvas.style.left=""+(window.innerWidth/2-this.canvas.width/2)+"px",e=window.SIZE.div(t),this.pixelSize*=e.x},this.flip=function(){return this.context.drawImage(this.buffer,0,0,this.canvas.width/this.pixelSize,this.canvas.height/this.pixelSize,0,0,this.canvas.width,this.canvas.height)}}),game.states.push(new States.Menu),game.start()},window.MOBILE&&document.addEventListener("deviceready",window.onload,!1)}).call(this);